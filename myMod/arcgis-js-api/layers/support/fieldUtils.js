// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.9/esri/copyright.txt for details.

define(["require","exports","@dojo/framework/shim/Set","../../core/object","./domains"],function(e,i,n,r,l){function a(e,n){if(null!=e&&null!=n)for(var r=0,l=Array.isArray(e)?e:[e];r<l.length;r++){var a=l[r];if(t(i.rendererFields,a,n),a.visualVariables)for(var o=0,u=a.visualVariables;o<u.length;o++){var s=u[o];t(i.visualVariableFields,s,n)}}}function t(e,i,n){if(e)for(var l=0,a=e;l<a.length;l++){var t=a[l],u=r.getDeepValue(t,i),s=u&&"function"!=typeof u&&o(u,n);s&&r.setDeepValue(t,s.name,i)}}function o(e,i){if("string"!=typeof e)return null;if(null!=i){e=e.toLowerCase();for(var n=0,r=i;n<r.length;n++){var l=r[n];if(l&&l.name.toLowerCase()===e)return l}}return null}function u(e){var i=e.defaultValue;return void 0!==i&&y(e,i)?i:e.nullable?null:void 0}function s(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function d(e){return null===e||s(e)}function f(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function c(e){return null===e||f(e)}function m(e){return null!=e&&"string"==typeof e}function p(e){return null===e||m(e)}function g(e){return!0}function y(e,i){var n;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":n=e.nullable?c:f;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":n=e.nullable?d:s;break;case"string":case"esriFieldTypeString":n=e.nullable?p:m;break;default:n=g}return 1===arguments.length?n:n(i)}function F(e){return null!=e&&_.has(e.type)}function v(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function V(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function b(e,i){return null===T(e,i)}function T(e,i){return e.nullable&&null===i?null:F(e)&&!I(e.type,i)?h.OUT_OF_RANGE:y(e,i)?e.domain?l.validateDomainValue(e.domain,i):null:A.INVALID_TYPE}function I(e,i){var n=E(e);return!!n&&(i>=n.min&&i<=n.max)}function D(e){var i=l.getDomainRange(e.domain);if(i)return i;if(F(e))return E(e.type)}function E(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":;return{min:-32768,max:32767};case"esriFieldTypeInteger":case"integer":;return{min:-2147483648,max:2147483647};case"esriFieldTypeSingle":case"single":;return{min:-3.4e38,max:1.2e38};case"esriFieldTypeDouble":case"double":var i=Number.MAX_VALUE;return{min:-Number.MAX_VALUE,max:i}}}function N(e,i,n){switch(e){case l.DomainValidationError.INVALID_CODED_VALUE:return"Value "+n+" is not in the coded domain - field: "+i.name+", domain: "+JSON.stringify(i.domain);case l.DomainValidationError.VALUE_OUT_OF_RANGE:return"Value "+n+" is out of the range of valid values - field: "+i.name+", domain: "+JSON.stringify(i.domain);case A.INVALID_TYPE:return"Value "+n+" is not a valid value for the field type - field: "+i.name+", type: "+i.type+", nullable: "+i.nullable;case h.OUT_OF_RANGE:var r=E(i.type),a=r.min,t=r.max;return"Value "+n+" is out of range for the number type - field: "+i.name+", type: "+i.type+", value range is "+a+" to "+t}}Object.defineProperty(i,"__esModule",{value:!0}),i.fixRendererFields=a,i.getField=o,i.getFieldDefaultValue=u,i.isValueMatchingFieldType=y,i.rendererFields=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],i.visualVariableFields=["field","normalizationField"],i.numericTypes=["integer","small-integer","single","double"];var _=new n.default(i.numericTypes.concat(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]));i.isNumericField=F,i.isStringField=v,i.isDateField=V,i.isValidFieldValue=b;var h;!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(h=i.NumericRangeValidationError||(i.NumericRangeValidationError={}));var A;!function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(A=i.TypeValidationError||(i.TypeValidationError={})),i.validateFieldValue=T,i.isNumberInRange=I,i.getFieldRange=D,i.validationErrorToString=N});