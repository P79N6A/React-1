// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.9/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/assignHelper"],function(t,a,h){function i(t,a){var h=t||{},i=h.format,e=h.quality,r=h.rotation,o=a.padding||I,n={width:a.width-o.left-o.right,height:a.height-o.top-o.bottom,padding:o},l=w(t,n),f=d(t,l),g=f.width,u=f.height,c=M(i),m=D[c];return{format:c,quality:s(null!=e?e:m,0,100),area:l,width:g,height:u,rotation:r}}function e(t,a){var h=i(t,a),e=h.area,r=h.width/e.width,o=a.padding,n=o.left+o.right,l=o.top+o.bottom,f=a.width-n,g=a.height-l;return{framebufferWidth:Math.floor(f*r+n),framebufferHeight:Math.floor(g*r+l),region:{x:Math.floor(e.x*r)+o.left,y:Math.floor(e.y*r)+o.top,width:h.width,height:h.height},format:h.format,quality:h.quality,rotation:h.rotation,pixelRatio:r}}function r(t,a,h,i){i.premultipliedAlpha&&v(t),h.width=t.width,h.height=t.height;var e=h.getContext("2d");e.putImageData(t,0,0),i.flipY&&p(e);var r=e.getImageData(0,0,t.width,t.height),n=o(h,a);return h.width=0,h.height=0,{dataUrl:n,data:r}}function o(t,a){var h=j[a.format],i=a.quality/100;return t.toDataURL(h,i)}function n(t,a,h){if(!t||!a)throw new Error("Cannot construct image data without dimensions");if(x)try{return new ImageData(t,a)}catch(t){x=!1}return g(t,a,h)}function l(t,a,h,i){if(!a||!h)throw new Error("Cannot construct image data without dimensions");if(x)try{return new ImageData(t,a,h)}catch(t){x=!1}var e=g(a,h,i);return e.data.set(t,0),e}function f(t,a,h,i,e,r,o,n){void 0===i&&(i=0),void 0===e&&(e=0),void 0===r&&(r=t.width-i),void 0===o&&(o=t.height-e),void 0===n&&(n=!1);for(var l=t.data,f=a.width,g=a.height,u=a.data,d=r/f,w=o/g,c=Math.ceil(d/2),m=Math.ceil(w/2),M=t.width,p=0;p<g;p++)for(var v=0;v<f;v++){for(var s=4*(v+(n?g-p-1:p)*f),y=0,x=0,j=0,b=0,D=0,I=0,q=(p+.5)*w,C=Math.floor(p*w);C<(p+1)*w;C++)for(var E=Math.abs(q-(C+.5))/m,R=(v+.5)*d,U=E*E,H=Math.floor(v*d);H<(v+1)*d;H++){var S=Math.abs(R-(H+.5))/c,O=Math.sqrt(U+S*S);if(!(O>=1)){var _=2*O*O*O-3*O*O+1,A=4*(i+H+(e+C)*M);I+=_*l[A+3],x+=_,!h&&l[A+3]<255&&(_=_*l[A+3]/255),j+=_*l[A],b+=_*l[A+1],D+=_*l[A+2],y+=_}}u[s]=j/y,u[s+1]=b/y,u[s+2]=D/y,u[s+3]=I/x}return a}function g(t,a,h){return h||(h=u()),h.getContext("2d").createImageData(t,a)}function u(){return y||(y=document.createElement("canvas"),y.width=1,y.height=1),y}function d(t,a){if(!t)return a;var h=t.width,i=t.height;if(null!=h&&null!=i)return{width:Math.floor(h),height:Math.floor(i)};if(null==h&&null==i)return a;var e=a.width/a.height;return null==i?{width:Math.floor(h),height:Math.floor(h/e)}:{width:Math.floor(i*e),height:Math.floor(i)}}function w(t,a){var h=0,i=0,e=a.width,r=a.height;if(t&&t.area){h=Math.floor(t.area.x)||0,i=Math.floor(t.area.y)||0;var o=null!=t.area.width?Math.floor(t.area.width):null,n=null!=t.area.height?Math.floor(t.area.height):null;if(e-=h,r-=i,null!=o&&null!=n)e=Math.min(e,o),r=Math.min(r,n);else if(null==o&&null!=n){var l=Math.min(e,o);r*=l/e,e=l}else if(null!=o&&null==n){var f=Math.min(r,n);e*=f/r,r=f}}return c(m({x:h,y:i,width:e,height:r},t),a)}function c(t,a){var h=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),e=Math.floor(Math.min(t.width,a.width-h)),r=Math.floor(Math.min(t.height,a.height-i)),o={x:h,y:i,width:e,height:r},n=o.width/o.height,l=t.width/t.height;if(l===n)return o;if(l>n){var f=Math.floor(o.width/l),g=o.height-f;return{x:o.x,y:Math.floor(o.y+g/2),width:o.width,height:f}}var u=Math.floor(o.height*l),d=o.width-u;return{x:Math.floor(o.x+d/2),y:o.y,width:u,height:o.height}}function m(t,a){if(!a||null==a.width||null==a.height)return t;var h=a.width/a.height,i=t.width/t.height;return i===h?t:i<h?(t.width=Math.floor(t.height*h),t.height=t.height,t):(t.width=t.width,t.height=Math.floor(t.width/h),t)}function M(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return b}}function p(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function v(t){for(var a=t.data,h=a.length,i=0;i<h;i+=4){var e=a[i+3];if(e>0){var r=e/255;a[i+0]=a[i+0]/r,a[i+1]=a[i+1]/r,a[i+2]=a[i+2]/r}}}function s(t,a,h){return t<a?a:t>h?h:t}Object.defineProperty(a,"__esModule",{value:!0}),a.completeUserSettings=i,a.toRenderSettings=e,a.encodeResult=r,a.toDataUrl=o,a.createEmptyImageData=n,a.wrapImageData=l,a.resampleHermite=f;var y=null,x=!0,j={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},b="jpg",D={png:100,jpg:98,jpeg:98},I={top:0,right:0,bottom:0,left:0}});