// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.9/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/tsSupport/paramHelper","../core/lang","../core/Logger","../core/accessorSupport/decorators","./Extent","./Geometry","./support/MeshComponent","./support/MeshVertexAttributes","./support/triangulationUtils","./support/meshUtils/centerAt","./support/meshUtils/offset","./support/meshUtils/primitives","./support/meshUtils/rotate"],function(e,t,n,r,o,i,s,a,p,c,u,l,m,h,f,x,y){function v(e,t){for(var n=e.components[0],r=n.faces,o=x.boxFaceOrder[t],i=6*o,s=new Uint32Array(6),a=new Uint32Array(r.length-6),p=0,c=0,l=0;l<r.length;l++)l>=i&&l<i+6?s[p++]=r[l]:a[c++]=r[l];for(var m=new Float32Array(e.vertexAttributes.uv),h=4*o*2,f=[0,1,1,1,1,0,0,0],l=0;l<f.length;l++)m[h+l]=f[l];return e.vertexAttributes.uv=m,e.components=[new u({faces:s,material:n.material}),new u({faces:a})],e}function d(e){return e/180*Math.PI}var g=s.getLogger("esri.geometry.Mesh"),A=function(e){function t(t){var n=e.call(this)||this;return n.components=null,n.hasZ=!0,n.hasM=!1,n.vertexAttributes=new l.MeshVertexAttributes,n.type="mesh",n}n(t,e),s=t,Object.defineProperty(t.prototype,"extent",{get:function(){var e=this.spatialReference,t=this.vertexAttributes&&this.vertexAttributes.position;if(!t||0===t.length||this.components&&0===this.components.length)return new p({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e});var n={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,zmin:1/0,zmax:-1/0,spatialReference:e};if(!this.components)return new p(this.extendExtent(n,t,null));for(var r=0,o=this.components;r<o.length;r++){var i=o[r];if(!i.faces){this.extendExtent(n,t,null);break}this.extendExtent(n,t,i.faces)}return new p(n)},enumerable:!0,configurable:!0}),t.prototype.addComponent=function(e){this.components||(this.components=[]),this.components.push(e),this.clearCache()},t.prototype.removeComponent=function(e){if(this.components){var t=this.components.indexOf(e);if(-1!==t)return void(this.components=this.components.splice(t,1))}g.error("removeComponent()","Provided component is not part of the list of components")},t.prototype.rotate=function(e,t,n,r){return y.axisAngleFrom(b.x,d(e),M),y.axisAngleFrom(b.y,d(t),U),y.axisAngleFrom(b.z,d(n),z),y.axisAngleMultiply(M,U,M),y.axisAngleMultiply(M,z,M),y.rotate(this,M,r),this},t.prototype.offset=function(e,t,n,r){return w[0]=e,w[1]=t,w[2]=n,f.offset(this,w,r),this},t.prototype.centerAt=function(e,t){return h.centerAt(this,e,t),this},t.prototype.clone=function(){return new s({components:i.clone(this.components),spatialReference:this.spatialReference,vertexAttributes:i.clone(this.vertexAttributes)})},t.prototype.vertexAttributesChanged=function(){this.clearCache()},t.prototype.toJSON=function(e){return this.write(null,e)},t.prototype.forEachVertex=function(e,t,n){if(t)for(var r=0;r<t.length;r++){var o=3*t[r];n(e[o+0],e[o+1],e[o+2])}else for(var r=0;r<e.length;r+=3)n(e[r+0],e[r+1],e[r+2])},t.prototype.extendExtent=function(e,t,n){return this.forEachVertex(t,n,function(t,n,r){e.xmin=Math.min(e.xmin,t),e.xmax=Math.max(e.xmax,t),e.ymin=Math.min(e.ymin,n),e.ymax=Math.max(e.ymax,n),e.zmin=Math.min(e.zmin,r),e.zmax=Math.max(e.zmax,r)}),e},t.createBox=function(e,t){var n=new s(x.convertUnitGeometry(x.createUnitSizeBox(),e,t));return t&&t.imageFace&&"all"!==t.imageFace?v(n,t.imageFace):n},t.createSphere=function(e,t){return new s(x.convertUnitGeometry(x.createUnitSizeSphere(t&&t.densificationFactor||0),e,t))},t.createCylinder=function(e,t){return new s(x.convertUnitGeometry(x.createUnitSizeCylinder(t&&t.densificationFactor||0),e,t))},t.createPlane=function(e,t){return new s(x.convertUnitGeometry(x.createUnitSizePlane(t&&t.facing||"up"),e,t))},t.createFromPolygon=function(e,t){var n=m.triangulate(e);return new s({vertexAttributes:{position:n.position},components:[{faces:n.faces,shading:"flat",material:t&&t.material||null}],spatialReference:e.spatialReference})};var s;return r([a.property({dependsOn:["vertexAttributes","vertexAttributes.position","components"],json:{read:!1}})],t.prototype,"cache",void 0),r([a.property({type:[u]})],t.prototype,"components",void 0),r([a.property({dependsOn:["cache"],readOnly:!0,json:{read:!1}})],t.prototype,"extent",null),r([a.property({readOnly:!0,json:{read:!1,write:!1}})],t.prototype,"hasZ",void 0),r([a.property({readOnly:!0,json:{read:!1,write:!1}})],t.prototype,"hasM",void 0),r([a.property({type:l.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],t.prototype,"vertexAttributes",void 0),r([o(0,a.cast(u))],t.prototype,"addComponent",null),t=s=r([a.subclass("esri.geometry.Mesh")],t)}(a.declared(c));A.prototype.toJSON.isDefaultToJSON=!0;var b={x:[1,0,0],y:[0,1,0],z:[0,0,1]},w=[0,0,0],M=[0,0,0,0],U=[0,0,0,0],z=[0,0,0,0];return A});